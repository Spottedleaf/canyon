From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001
From: Andrew Steinborn <git@steinborn.me>
Date: Sun, 6 Oct 2019 17:06:39 -0400
Subject: [PATCH] Disable Nagle's algorithm


diff --git a/src/main/java/com/canyonmodded/network/NettyBootstrap.java b/src/main/java/com/canyonmodded/network/NettyBootstrap.java
index 0e58eeff557ea7acc1f41384a057b390bbe9a168..c4bf01960a394c34a62a93db17ff1af635cb4ffc 100644
--- a/src/main/java/com/canyonmodded/network/NettyBootstrap.java
+++ b/src/main/java/com/canyonmodded/network/NettyBootstrap.java
@@ -76,6 +76,8 @@ public class NettyBootstrap {
                     @Override
                     protected void initChannel(Channel channel) throws Exception {
                         channel.config().setOption(ChannelOption.IP_TOS, 24);
+                        // Disable Nagle's algorithm
+                        channel.config().setOption(ChannelOption.TCP_NODELAY, true);
 
                         NetLoginHandler handler = new NetLoginHandler(server, channel);
                         channel.pipeline()
diff --git a/src/main/java/net/minecraft/server/NetworkManager.java b/src/main/java/net/minecraft/server/NetworkManager.java
index 856189308bed4ea27af2b9b052e7601c54a38164..e393ad566e07894bf9914196e223fa465c297109 100644
--- a/src/main/java/net/minecraft/server/NetworkManager.java
+++ b/src/main/java/net/minecraft/server/NetworkManager.java
@@ -59,6 +59,7 @@ public class NetworkManager {
         try {
             // CraftBukkit start - cant compile these outside the try
             socket.setSoTimeout(30000);
+            socket.setTcpNoDelay(true); // Canyon - disable Nagle's algorithm
             this.input = new DataInputStream(socket.getInputStream());
             this.output = new DataOutputStream(new BufferedOutputStream(socket.getOutputStream(), 5120));
         } catch (java.io.IOException socketexception) {
